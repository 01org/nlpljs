<!--
tile for a general web page (article)
-->
<polymer-element name="cp-tile-article" attributes="src loaded done">
  <template>
    <link rel="stylesheet" href="styles/cp-tile.css">

    <style>
      h3 {
        font-size: 0.875em;
      }

      p {
        font-size: 0.42em;
      }

      #text {
        height: 100%;
        width: 100%;
      }

      #text > * {
        margin: 0 16px;
      }

      #image {
        overflow: hidden;
      }

      #caption, #snippet {
        padding-top: 8px;
      }

      .text-elide {
        overflow: hidden;
        text-overflow: ellipsis;

        /* these provide the multi-line ellipsis over 2 lines, but
           only work in WebKit; as we're dependent on Chrome, I decided it
           was OK */
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
      }

      .left {
        width: 36% !important;
      }

      .right {
        width: 64% !important;
      }

      #meta {
        position: absolute;
        bottom: 4px;
      }

      #meta p {
        margin: 0.25em 0;
      }
    </style>

    <div id="container">
      <div horizontal layout fit>
        <div id="image" class="left" data-show="{{src !== null}}">
          <img src="{{src}}">
        </div>

        <div id="text" class="{{src === null ? '' : 'right'}}">
          <h2 id="caption" class="text-elide">
            {{caption}}
          </h2>

          <h3 id="snippet" class="text-elide">{{snippet}}</h3>

          <div id="meta">
            <p id="source">{{source|domainFromURL}}</p>
          </div>
        </div>
      </div>
    </div>

  </template>

  <script src="./cp-layout-frame-chooser.js"></script>
  <script src="./cp-formatter.js"></script>

  <script>
    (function () {
      Polymer({
        created: function () {
          /* THESE PROPERTIES SHOULD BE SET WHEN THE TILE IS CREATED */

          /* URL for the file thumbnail to be displayed */
          this.src = null;

          /* title to show at the bottom of the tile */
          this.caption = '';

          /* snippet of the article */
          this.snippet = null;

          /* source */
          this.source = null;

          /* the original data used to construct the tile, as
             returned by a file search */
          this.article = {};

          /* keyword associated with the image with structure:
             {
               text: "<keyword text>",
               groupId: "<keyword group ID>"
             }
          */
          this.keywords = [];

          /* PROPERTIES BELOW DON'T NEED TO BE SET */

          /* type of object used to create the tile */
          this.type = 'article';

          /* hard code frame for article tiles */
          this.frame = FrameChooser.FRAMES['large_square'];

          /* we always set loaded to true, so that article tiles are
             loaded into cp-display regardless of whether their related
             thumbnail loads */
          this.loaded = true;

          /* article tiles are always ready */
          this.done = true;
        },

        /* if the tile has an image, use landscape1 frame; otherwise use
           the default frame (large_square) */
        srcChanged: function () {
          if (this.src) {
            this.frame = FrameChooser.FRAMES['landscape1'];
          } else {
            this.frame = FrameChooser.FRAMES['large_square'];
          }
        },

        domainFromURL: Formatter.domainFromURL
      });
    })();
  </script>
</polymer-element>
