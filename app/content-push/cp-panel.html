<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../bower_components/core-icon/core-icon.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="./cp-fetcher.html">
<link rel="import" href="./cp-display.html">

<polymer-element name='cp-panel' on-newkeywordinfo='{{onNewKeywordInfo}}'>
  <template>
    <style>
      :host {
        height: 100%;
      }

      #toolbar {
        display: block;
        background-color: #202020;
        margin: 0;
        padding: 0;
      }

      #toolbartext {
        color: #FFFFFF;
        -webkit-user-select: none;
      }

      #toolbaraction {
        color: #FFFFFF;
        -webkit-user-select: none;
      }

      #menutoolbar {
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
      }

      #display {
        margin: 3px;
        padding: 0;
        height: 90%;
        width: 100%;
        overflow: hidden;
        box-sizing: border-box;
      }

      #tabs {
        width: 100%;
        padding: 0;
        margin: -15px 0 0 0;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        background-color: white;
      }

      core-toolbar paper-tabs {
        box-shadow: none;
      }

      #tabs::shadow #selectionBar {
        background-color: #4CA8B4;
      }
    </style>

    <!-- the panel is made up of a header toolbar, a content toolbar and the display -->
    <core-toolbar id="toolbar">
      <div id="toolbartext" flex>Content Push</div>
      <core-icon-button id="toolbaraction" icon="close" on-tap="{{closePanel}}"></core-icon-button>
    </core-toolbar>

    <!--Tabs Menu-->
    <paper-tabs id="tabs" noink>
      <paper-tab>
        <core-icon icon="drive-image"></core-icon>
      </paper-tab>
      <paper-tab>
        <core-icon icon="drive"></core-icon>
      </paper-tab>
      <paper-tab>
        <core-icon icon="subject"></core-icon>
      </paper-tab>
      <paper-tab>
        <core-icon icon="more-vert"></core-icon>
      </paper-tab>
    </paper-tabs>

    <cp-display id="display"
                on-moreresults="{{onDisplayMoreResults}}"
                on-mouse-over="{{onDisplayMouseover}}"
                on-mouse-out="{{onDisplayMouseout}}">
    </cp-display>

    <cp-fetcher id="fetcher" resultsPerFetch="5"></cp-fetcher>
  </template>
  <script>
    (function cpPanel () {
      // private *static* functions and constants

      /* perform search for keyphrases and populate the image card
        for the associated page. */
      var search = function (self) {
        // search for one keyphrase
        // TODO search for all keyphrases
        var keyphrase = self.keywordInfo.keywords[0];

        // append each image
        self.$.fetcher.fetch(keyphrase.text).then(function (results) {
          self.$.display.receiveResults(results, keyphrase);
        });
      };

      Polymer({
        // functions and properties used in API and bindings
        created: function () {
          this.keywordInfo = null;
        },

        // called from content-push.html:trackAction() when splitter moves
        layout: function () {
          this.$.display.layout();
        },

        // event handlers
        onNewKeywordInfo: function (e) {
          console.log('PA:onNewKeywordInfo',e.detail.keywordInfo);
          this.keywordInfo = e.detail.keywordInfo;
          search(this);
        },

        onDisplayMoreResults: function () {
          this.$.display.loading = true;
          search(this);
        },

        onDisplayMouseover: function (e) {
          this.fire('mouseoverimage', {groupId: e.detail.groupId});
        },

        onDisplayMouseout: function (e) {
          this.fire('mouseoutimage', {groupId: e.detail.groupId});
        },

        closePanel: function () {
          this.fire('close-panel');
        }
      }); // Polymer()
    })();

  </script>
</polymer-element>
