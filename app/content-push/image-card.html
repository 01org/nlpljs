<link rel="import" href="./image-item.html">
<!--link rel="import" href="../bower_components/paper-fab/paper-fab.html"-->

<polymer-element name="image-card">
  <template>
    <style>
      :host {
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      #container {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
      }

      #more {
        display: block;
        margin-left: 50%;
      }

      #morebutton {
        background-color:grey;
      }

      /*
      when an image-item displays inside an image-card, a margin
      appears to be added below the meta paragraph; I couldn't track
      this down, so this work-around removes that margin for
      image-items only in the context of an image-card
      */
      image-item::shadow #meta {
        margin: 0 0 5px 0;
      }

      image-item::shadow img {
        width: 100%;
        height: auto;
      }
    </style>

    <div id="container"></div>
    <div id="more">
      <paper-fab id="morebutton" mini icon="expand-more" raisedButton="true" on-click={{moreImages}}></paper-fab>
    </div>
  </template>

  <script src="image-card-frame-chooser.js"></script>

  <script>
    (function () {
      /*
       size in pixels of the size of a "cell" in the layout;
       50px (element) + 2px gutter on each edge == 54
       */
      var CELL_SIDE = 54;

      Polymer({
        // all instances share a single FrameChooser
        frameChooser: new FrameChooser(CELL_SIDE, CELL_SIDE),

        /**
        * Convenience method to append an image search result to the
        * gallery; creates a cp-image element for the image object added.
        *
        * @param Object image Representation of image to add; has the
        * format:
        * {
        *   src: <url of image>
        * }
        */
        appendImage: function (image, keyword) {
          var self = this;

          var elt = document.createElement('image-item');

          elt.addEventListener('load', function () {
            self.frameImage(elt);
            self.$.container.appendChild(elt);
            self.layout();
          });

          elt.$.container.addEventListener('mouseover', function () {
            self.fire('mouse-over', { keyword: elt.keyword });
          });

          elt.$.container.addEventListener('mouseout', function () {
            self.fire('mouse-out', { keyword: elt.keyword });
          });

          elt.src = image.src;
          elt.keyword = keyword;
        },

        /**
         * Add the appropriate frame to the image-item img.
         *
         * @param DOMElement img image-item element
         */
        frameImage: function (img) {
          var frame = this.frameChooser.choose(img);
          img.setAttribute('data-frame', frame.name);
        },

        /**
         * Apply layout to image-items.
         */
        layout: function () {
          var imageItems = this.$.container.querySelectorAll('image-item');
        },

        moreImages: function(){
          console.log('more images');
          for (var i = 0; i < 10; i ++) {
            var src = 'http://lorempixel.com/125/125?cacheBust=' +
                      (new Date()).getTime() + i;
            this.appendImage({src: src});
          }
        }
      })
    })();
  </script>
</polymer-element>
