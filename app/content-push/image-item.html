<!--
wrapper for a single img element plus related elements for
metadata; metadata elements are revealed by user interaction
(mouse hover);
the smallest image which will display OK is about 50x50px; any smaller
than this and there's not enough room for the metadata about the image
size
-->
<polymer-element name="image-item" attributes="src revealmeta">
  <template>
    <style>
      #container {
        display: inline-block;
        position: relative;
        overflow: hidden;
        height: 100%;
        width: 100%;
      }

      [data-revealed="true"] {
        display: block;
        position: absolute;
        bottom: 0;
        margin-bottom: 5px;
        background-color: black;
        color: white;
        min-width: 3em;
        text-align: center;
        padding: 0.5em;
      }

      /* adjust padding on the meta text when the image is < 100 pixels */
      [data-tiny-image="true"] {
        padding: 0.25em 0.1em !important;
      }

      [data-revealed="false"] {
        display: none;
      }
    </style>

    <div id="container" on-mouseover="{{revealmetaOn}}" on-mouseout="{{revealmetaOff}}">
      <img id="image" src="{{src}}" on-load="{{imageLoaded}}">
      <p id="meta" data-revealed="{{revealmeta === 'on' || revealmeta === 'always'}}" data-tiny-image="{{isTinyImage}}">
        {{width}}x{{height}}
      </p>
    </div>
  </template>

  <script>
    Polymer({
      // URL for the image to display
      src: null,

      // width, height and ratio are set when the wrapped image has loaded
      width: 0,
      height: 0,
      ratio: 0,

      // true if the wrapped image's load event has fired
      loaded: false,

      // true if the image's width is less than 100px
      isTinyImage: false,

      // set to 'on' to reveal metadata; set to 'off' to hide it;
      // set to 'always' if metadata should always be visible
      revealmeta: 'off',

      revealmetaOn: function () {
        if (this.revealmeta === 'always') {
          return;
        }

        this.revealmeta = 'on';
      },

      revealmetaOff: function () {
        if (this.revealmeta === 'always') {
          return;
        }

        this.revealmeta = 'off';
      },

      srcChanged: function () {
        this.loaded = false;
      },

      // set metadata for the image once it's loaded
      imageLoaded: function () {
        this.height = this.$.image.height;
        this.width = this.$.image.width;

        if (this.height > 0) {
          this.ratio = this.width / this.height;
        }

        // mark tiny images so the metadata display can be adjusted
        this.isTinyImage = (this.width < 100);

        this.loaded = true;
        this.fire('load', this);
      }
    });
  </script>
</polymer-element>
