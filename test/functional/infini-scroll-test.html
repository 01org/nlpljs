<link rel="import" href="../../app/content-push/infini-scroll.html">
<link rel="import" href="../../app/content-push/cp-layout.html">

<!--
test for infini-scroll
-->
<polymer-element name="infini-scroll-test">
  <template>
    <style>
      #container {
        width: 400px;
        height: 600px;
      }

      infini-scroll {
        width: 100%;
        height: 100%;
      }
    </style>

    <p>The outer container is a fixed height to represent the
    content-push element; the infini-scroll is styled to fill its
    parent.</p>

    <ul>
      <li>To start with, there are no images, and you see the welcome
      message.</li>
      <li>Then one image loads, with a button to "widen the search"
      should be visible. Clicking this button loads four images
      which replace the existing ones.</li>
      <li>After loading these images, the button should be hidden
      and new images load when the user scrolls near the bottom of
      the scroller.</li>
    </ul>

    <div id="container">
      <infini-scroll id="scroller" on-morecontent="{{addImages}}"
                     on-replacecontent="{{fetchImages}}">
        <cp-layout id="gallery"></cp-layout>
      </infini-scroll>
    </div>
  </template>

  <script src="./test-utils.js"></script>

  <script>
    Polymer({
      created: function () {
        var self = this;

        /*
        for stubbing purposes, record how many times replaceImages()
        has been called; this is so that the first call adds only
        1 image (so the "widen search" button is visible); and
        the second call adds 8 (to show the "more content on scroll"
        behaviour)
        */
        this.callsToFetchImages = 0;

        setTimeout(function () {
          self.fetchImages();
        }, 2000);
      },

      addImages: function () {
        // add some images to the gallery
        for (var i = 0; i < 2; i ++) {
          this.$.gallery.appendImage({
            src: makeImageUrl(200, 200)
          });
        }
      },

      fetchImages: function () {
        this.callsToFetchImages++;

        // show more images on the second call to this function
        var numImages = (this.callsToFetchImages === 1 ? 1 : 4)

        this.$.gallery.clear();

        for (var i = 0; i < numImages; i ++) {
          this.$.gallery.appendImage({
            src: makeImageUrl(200, 200)
          });
        }
      }
    });
  </script>
</polymer-element>
